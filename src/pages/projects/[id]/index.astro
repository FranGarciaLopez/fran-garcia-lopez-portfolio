---
import type { GetStaticPaths } from "astro";
import projectData from "../../../data/projects.json";
import ProjectFeatures from "../../../components/ProjectsFeatures.astro";
import Layout from "../../../layouts/Layout.astro";
import BentoGrid from "../../../components/BentoGrid.astro";
import { fetchGitHubRepoData } from "../../../utils/github";

export const getStaticPaths: GetStaticPaths = async () => {
          return projectData.projects.map((project) => ({
                    params: { id: project.id.toString() },
                    props: { project },
          }));
};

interface AlgorithmFeature {
          description: string;
          benefits?: string[];
          steps?: string[];
}

interface Project {
          id: string;
          name: string;
          images: string;
          description: { text: string }[];
          role: string;
          institution: string;
          timeframe: string;
          github_repositories?: string[];
          algorithm_features?: {
                    dynamic_grouping?: AlgorithmFeature;
                    group_formation_process?: AlgorithmFeature;
                    unique_event_assignment?: AlgorithmFeature;
                    data_persistence?: AlgorithmFeature;
          };
          url: string;
}

const { project } = Astro.props as { project: Project };

const repoData = await Promise.all(
          project.github_repositories?.map(fetchGitHubRepoData) || [],
);
---

<Layout title=`Project | ${project.name}`>
          <section
                    class="relative min-h-screen bg-[#222428] text-white py-16 px-4 lg:px-0"
          >
                    <div class="max-w-4xl mx-auto">
                              <button
                                        type="button"
                                        class="text-[#eae0d5] rounded-2xl py-2 px-2 hover:bg-[#c2b280] hover:text-black transition-all duration-300 flex items-center"
                                        onclick="window.history.back()"
                              >
                                        <svg
                                                  class="w-8 h-8"
                                                  fill="currentColor"
                                                  viewBox="0 0 20 20"
                                        >
                                                  <path
                                                            fill-rule="evenodd"
                                                            d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z"
                                                            clip-rule="evenodd"
                                                  ></path>
                                        </svg>
                              </button>
                              <h1
                                        class="text-3xl md:text-7xl lg:text-5xl font-semibold tracking-wide text-[#f5f5dc] uppercase mt-6"
                              >
                                        {project.name}
                              </h1>
                              <div
                                        class="mt-6 text-lg md:text-2xl lg:text-xl text-[#eae0d5] leading-relaxed lg:m-2"
                              >
                                        {
                                                  project.description.map(
                                                            (desc) => (
                                                                      <p class="py-4 md:py-6">
                                                                                {
                                                                                          desc.text
                                                                                }
                                                                      </p>
                                                            ),
                                                  )
                                        }
                              </div>

                              {
                                        repoData.length > 0 && (
                                                  <div class="mt-6">
                                                            <h2 class="text-lg text-[#f5f5dc] font-bold">
                                                                      GitHub
                                                                      Repositories:
                                                            </h2>
                                                            <ul class="list-disc list-inside text-[#c2b280]">
                                                                      {repoData.map(
                                                                                (
                                                                                          repo,
                                                                                ) =>
                                                                                          repo ? (
                                                                                                    <li class="mb-2">
                                                                                                              <a
                                                                                                                        href={
                                                                                                                                  repo.url
                                                                                                                        }
                                                                                                                        class="text-[#0099ff] underline hover:text-[#0077cc] transition-all duration-300"
                                                                                                                        target="_blank"
                                                                                                                        rel="noopener noreferrer"
                                                                                                              >
                                                                                                                        {repo.url
                                                                                                                                  .split(
                                                                                                                                            "/",
                                                                                                                                  )
                                                                                                                                  .pop()}
                                                                                                              </a>
                                                                                                              <span class="text-[#f5f5dc] ml-2">
                                                                                                                        ‚≠ê{" "}
                                                                                                                        {
                                                                                                                                  repo.stars
                                                                                                                        }{" "}
                                                                                                                        |
                                                                                                                        üç¥{" "}
                                                                                                                        {
                                                                                                                                  repo.forks
                                                                                                                        }{" "}
                                                                                                                        |
                                                                                                                        üìÖ{" "}
                                                                                                                        {
                                                                                                                                  repo.lastUpdated
                                                                                                                        }
                                                                                                              </span>
                                                                                                    </li>
                                                                                          ) : null,
                                                                      )}
                                                            </ul>
                                                  </div>
                                        )
                              }

                              <BentoGrid
                                        project_images={project.images}
                                        class="mt-12"
                              />
                              {
                                        project.algorithm_features && (
                                                  <ProjectFeatures
                                                            algorithm_features={
                                                                      project.algorithm_features
                                                            }
                                                  />
                                        )
                              }
                              <div
                                        class="text-[#c2b280] md:text-xl space-y-4 mx-2 my-2"
                              >
                                        <p class="text-lg">
                                                  <strong
                                                            class="text-[#f5f5dc] text-lg"
                                                            >Role:</strong
                                                  >
                                                  {project.role}
                                        </p>
                                        <p class="text-lg">
                                                  <strong
                                                            class="text-[#f5f5dc] text-lg"
                                                            >Institution:</strong
                                                  >
                                                  {
                                                            project.institution.includes(
                                                                      "MiduDev",
                                                            ) ? (
                                                                      <span class="text-[#0099ff] font-bold text-lg">
                                                                                Inspired
                                                                                by
                                                                                MiduDev's
                                                                                tutorial
                                                                      </span>
                                                            ) : (
                                                                      <span class="text-[#fcb700] text-lg">
                                                                                {
                                                                                          project.institution
                                                                                }
                                                                      </span>
                                                            )
                                                  }
                                        </p>
                                        <p class="text-lg">
                                                  <strong
                                                            class="text-[#f5f5dc] text-lg"
                                                            >Timeframe:</strong
                                                  >
                                                  {project.timeframe}
                                        </p>
                                        <div class="mt-6">
                                                  <a
                                                            href={project.url}
                                                            class="inline-block text-black font-bold bg-[#eae0d5] text-lg
                                                            rounded-lg hover:bg-[#c2b280] transition-all duration-300 py-2 px-3 mx-2"
                                                  >
                                                            Check the Project
                                                  </a>
                                        </div>
                              </div>
                    </div>
          </section>
</Layout>
